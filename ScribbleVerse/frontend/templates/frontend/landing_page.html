<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScribbleVerse</title>
    <link rel="stylesheet" href="landing_page_css.css">
</head>
<body>
    <div class="background-animation"></div>
    
    <div class="container">
        <h1 class="title">ScribbleVerse</h1>
        <div class="login-box">
            <label for="username">Username</label>
            <input type="text" id="username" placeholder="Enter your username">
            
            <label for="roomCode">Room Code (Optional)</label>
            <input type="text" id="roomCode" placeholder="Enter room code">

            <button class="play-btn" onclick="joinRoom()">Join Room</button>
            <button class="create-room-btn" onclick="createRoom()">Create Room</button>
        </div>
    </div>

    <script>
        async function joinRoom() {
            let username = document.getElementById("username").value.trim();
            let roomCode = document.getElementById("roomCode").value.trim();
            
            if (!username) {
                alert("Please enter a username!");
                return;
            }

            if (!roomCode) {
                alert("Please enter a room code or create a new room!");
                return;
            }

            try {
                let response = await fetch(`/api/validate-room-code/${roomCode}/`);
                let data = await response.json();

                if (response.ok && data.valid) {
                    // Store session details in local storage
                    sessionStorage.setItem("username", username);
                    sessionStorage.setItem("roomCode", roomCode);

                    window.location.href = `room.html?room=${roomCode}&username=${username}`;
                } else {
                    alert("Invalid room code. Try again.");
                }
            } catch (error) {
                console.error("Error validating room:", error);
                alert("Server error. Please try again later.");
            }
        }

        async function createRoom() {
            let username = document.getElementById("username").value.trim();

            if (!username) {
                alert("Please enter a username!");
                return;
            }

            try {
                let response = await fetch("/api/create-room/", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ host: username })
                });

                let data = await response.json();

                if (response.ok) {
                    // Store session details in local storage
                    sessionStorage.setItem("username", username);
                    sessionStorage.setItem("roomCode", data.code);

                    window.location.href = `room.html?room=${data.code}&username=${username}`;
                } else {
                    alert("Error creating room. Try again later.");
                }
            } catch (error) {
                console.error("Error creating room:", error);
                alert("Server error. Please try again later.");
            }
        }
    </script>
</body>
</html>
